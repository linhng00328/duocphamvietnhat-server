<?php

namespace App\Http\Controllers\Api\Admin;

use App\Helper\Helper;
use App\Helper\InventoryUtils;
use App\Helper\IPUtils;
use App\Helper\ProductUtils;
use App\Helper\StringUtils;
use App\Helper\TypeFCM;
use App\Http\Controllers\Api\User\ProductController;
use App\Http\Controllers\Controller;
use App\Jobs\PushNotificationCustomerJob;
use App\Models\Agency;
use App\Models\Branch;
use App\Models\Collaborator;
use App\Models\Customer;
use App\Models\MsgCode;
use App\Models\Order;
use App\Models\OrderRecord;
use App\Models\Product;
use App\Models\Store;
use App\Models\TaskNoti;
use App\Models\User;
use App\Models\UserAdvice;
use App\Models\WebTheme;
use Carbon\Carbon;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\DB;

use function PHPUnit\Framework\isEmpty;

/**
 * @group  Admin/Migrate
 *
 * Đưa khách qua IKItech
 */
class AdminMigrateController extends Controller
{
    /**
     * Đưa khách qua IKItech
     */

    public function migrate2(Request $request)
    {



        return response()->json([
            'code' => 200,
            'success' => true,
            'msg_code' => MsgCode::SUCCESS[0],
            'msg' => MsgCode::SUCCESS[1],
        ], 200);
    }


    public function migrate(Request $request)
    {

        $dataRef = [
            [
                "main_customer_phone" => "0906087369",
                "ref_customer_phone" => [
                    "0332198246",
                    "0988750272",
                    "0396407660",
                    "0962700704",
                    "0988001891",
                    "0904552657",
                    "0984535630",
                    "0978898000",
                    "0976299537",
                    "0963865232",
                    "0961301386",
                    "0945759329",
                    "0942430192",
                    "0937895940",
                    "0917178779",
                    "0913399623",
                    "0909041729",
                    "0904909701",
                    "0366097477",
                    "0365672492",
                    "0349963333",
                    "0348133333",
                    "0346778998",
                    "0345079785",
                    "0344183638",
                    "0342099924",
                    "0333843888",
                    "0327578093",
                    "0977259082",
                    "0975604818",
                    "0336578465",
                    "0394425376",
                    "0969162823",
                    "0943966543",
                    "0793368641",
                    "0969099647",
                    "0988158682",
                    "0388314759",
                    "0377995621",
                    "0392426024",
                    "0336467311",
                    "0796304084",
                    "0528892380",
                    "0972639297",
                    "0345973397",
                    "0916793407",
                    "0914054295",
                    "0356072668",
                    "0962010091",
                    "0347241004",
                    "0797908669",
                    "0376427590",
                    "0898419479",
                    "0354931556",
                    "0963832204",
                    "0522684800",
                    "0395415810",
                    "0963888836",
                    "0907904683",
                    "0943312816",
                    "0389443587",
                    "0988333545",
                    "0966093306",
                    "0983354557",
                    "0972988019",
                    "0389268886",
                    "0902528044",
                    "0974675585",
                    "0946421249",
                    "0388943041",
                    "0939599384",
                    "0977351993",
                    "0706898488",
                    "0967059689",
                    "0785199562",
                    "0853232187",
                    "0942303309",
                    "0965025734",
                    "0352798037",
                    "0866496113",
                    "0398742633",
                    "0915243640",
                    "0972361087",
                    "0904720291",
                    "0818721526",
                    "0832951769",
                    "0344226317",
                    "0368430390",
                    "0386277487",
                    "0329628838",
                    "0379322197",
                    "0337276817",
                    "0829911157",
                    "0937811073",
                    "0767120462",
                    "0866123686",
                    "0973826194",
                    "0339218721",
                    "0397945783",
                    "0973281365",
                    "0936870607",
                    "0978865211",
                    "0368616606",
                    "0795317870",
                    "0967778919",
                    "0327475379",
                    "0366370443",
                    "0786539539",
                    "0973797008",
                    "0877085543",
                    "0338318534",
                    "0334321257",
                    "0364457526",
                    "0859853857",
                    "0988456531",
                    "0965185821",
                    "0343260803",
                    "0981145092",
                    "0362323113",
                    "0383464737",
                    "0366525682",
                    "0982828080",
                    "0947165244",
                    "0333486456",
                    "0972598556",
                    "0988541328",
                    "0799647146",
                    "0793307907",
                    "0918932728",
                    "0364033729",
                    "0941219343",
                    "0385140285",
                    "0965660723",
                    "0346057514",
                    "0966827307",
                    "0777336566",
                    "0562937278",
                    "0989500688",
                    "0916503869",
                    "0773461518",
                    "0867002101",
                    "0973229720",
                    "0366078978",
                    "0916707232",
                    "0979508229",
                    "0901410369",
                    "0909455567",
                    "0829653911",
                    "0369011621",
                    "817022876605",
                    "0918355324",
                    "0878878115",
                    "0975402898",
                    "0938940721",
                    "0865830047",
                    "0947880066",
                    "0968900911",
                    "0347868123",
                    "0907526166",
                    "0919086704",
                    "0913368687",
                    "0399940583",
                    "0963157810",
                    "0988315601",
                    "0916880966",
                    "0355035562",
                    "0961782696",
                    "0922395009",
                    "0918383109",
                    "0392239221",
                    "0901615459",
                    "0335914275",
                    "0948484586",
                    "0332762853",
                    "0972842534",
                    "0924175139",
                    "0339286238",
                    "0979992385",
                    "0389550745",
                    "0946977268",
                    "0345889154",
                    "0936936232",
                    "0973473837",
                    "0945553554",
                    "0971497519",
                    "0966192288",
                    "0795657284",
                    "0339191780",
                    "0904618437",
                    "0378135123",
                    "0935000755",
                    "0376764445",
                    "0327279339",
                    "0796441557",
                    "0868746238",
                    "0934059142",
                    "0944668660",
                    "0937596786",
                    "0935298292",
                    "0967674142",
                    "0876131989",
                    "0964135499",
                    "0904547139",
                    "0862835695",
                    "0931394630",
                    "0367739985",
                    "0907164518",
                    "0906594784",
                    "0868377571",
                    "0866664405",
                    "0942032947",
                    "0984979728",
                    "0964201262",
                    "0363699369",
                    "0971841554",
                    "0906460784",
                    "0983029488",
                    "0777555966",
                    "0388756621",
                    "0986083101",
                    "0364994253",
                    "0349614645",
                    "0977867649",
                    "0986192903",
                    "0965232933",
                    "0899149014",
                    "0377791445",
                    "0962012079",
                    "0973330699",
                    "0986364666",
                    "0986924050",
                    "0916036918",
                    "0979568183",
                    "0939727239",
                    "0965274372",
                    "0396618141",
                    "0384877621",
                    "0372105873",
                    "0799180518",
                    "0794133358",
                    "0962410930",
                    "0973274347",
                    "0906116772",
                    "0338545507",
                    "0935619704",
                    "0777703579",
                    "0931931672",
                    "0334090478",
                    "0352365942",
                    "0914298558",
                    "0971463819",
                    "0395051555",
                    "0849031222",
                    "0947046447",
                    "0906654480",
                    "0934174232",
                    "0879820348",
                    "0879558223",
                    "0945950880",
                    "0971307257",
                    "0352283856",
                    "0342190313",
                    "0989985523",
                    "0374700323",
                    "0989666491",
                    "817090714385",
                    "0588948338",
                    "0936673456",
                    "0918303235",
                    "0938597086",
                    "0939717716",
                    "0971734944",
                    "0769828482",
                    "0855588645",
                    "0869273901",
                    "0974167873",
                    "0373340355",
                    "0326447278",
                    "0363153713",
                    "0337412706",
                    "0936949282",
                    "0989124970",
                    "0983252183",
                    "0919325043",
                    "0389364693",
                    "0985038906",
                    "0865536368",
                    "0396809886",
                    "0858899222",
                    "0939940949",
                    "0353990859",
                    "0853608688",
                    "0388657939",
                    "0868848381",
                    "0936604779",
                    "0904573223",
                    "0945830740",
                    "0373619636",
                    "0359162467",
                    "817032996306",
                    "0702808386",
                    "0978158699",
                    "0931480041",
                    "0879793076",
                    "0877780840",
                    "0961635403",
                    "971542281939",
                    "0966969127",
                    "0327978303",
                    "0964012621",
                    "0948977809",
                    "0772627637",
                    "0986318705",
                    "0356238880",
                    "0975075640",
                    "0901492696",
                    "0983613404",
                    "0966967927",
                    "0363801725",
                    "0985828489",
                    "0766585969",
                    "0363501398",
                    "0345652944",
                    "0988077152",
                    "0865220343",
                    "0377473796",
                    "0974938737",
                    "0354496007"
                ]
            ],
            [
                "main_customer_phone" => "0981786768",
                "ref_customer_phone" => [
                    "0978076833",
                    "0905194445",
                    "0365128934",
                    "0329371019",
                    "0938749298",
                    "0973824110",
                    "0949211357",
                    "0913261192",
                    "0904334444",
                    "0982643469",
                    "0848484953",
                    "0369604720"
                ]
            ],
            [
                "main_customer_phone" => "0372079007",
                "ref_customer_phone" => [
                    "0368850538"
                ]
            ],
            [
                "main_customer_phone" => "0369163095",
                "ref_customer_phone" => [
                    "0377854621"
                ]
            ],
            [
                "main_customer_phone" => "0329371019",
                "ref_customer_phone" => [
                    "0937076929"
                ]
            ],
            [
                "main_customer_phone" => "0965541479",
                "ref_customer_phone" => [
                    "0355994583",
                    "0934913397",
                    "0978427318",
                    "0932710918",
                    "0708219841"
                ]
            ],
            [
                "main_customer_phone" => "0394425376",
                "ref_customer_phone" => [
                    "0919914660",
                    "0939458967"
                ]
            ],
            [
                "main_customer_phone" => "0966093306",
                "ref_customer_phone" => [
                    "0397795507",
                    "0942947915",
                    "0979817007",
                    "0888855995"
                ]
            ],
            [
                "main_customer_phone" => "0936870607",
                "ref_customer_phone" => [
                    "0364749268"
                ]
            ],
            [
                "main_customer_phone" => "0327475379",
                "ref_customer_phone" => [
                    "0367279415"
                ]
            ],
            [
                "main_customer_phone" => "0773461518",
                "ref_customer_phone" => [
                    "0779420158"
                ]
            ],
            [
                "main_customer_phone" => "0867002101",
                "ref_customer_phone" => [
                    "0352111997",
                    "0346982950",
                    "0395141412",
                    "0983238448",
                ]
            ],
            [
                "main_customer_phone" => "0347868123",
                "ref_customer_phone" => [
                    "0869866599"
                ]
            ],
            [
                "main_customer_phone" => "0942032947",
                "ref_customer_phone" => [
                    "0973310365",
                    "0935832485"
                ]
            ],
            [
                "main_customer_phone" => "0986924050",
                "ref_customer_phone" => [
                    "0976450445",
                    "0947474380",
                    "0354899368",
                    "0788881149",
                    "0907890907",
                    "0363989861",
                    "0396773339",
                    "0907938763",
                    "0947266088",
                    "0354675237",
                    "0817108555",
                    "0966969459",
                    "0949798152",
                    "0969993660"
                ]
            ],
            [
                "main_customer_phone" => "0976450445",
                "ref_customer_phone" => [
                    "0946858462",
                    "0833152452",
                    "0836169936",
                ]
            ],
            [
                "main_customer_phone" => "0788881149",
                "ref_customer_phone" => [
                    "0356656221",
                    "0985778454",
                    "0867769146",
                    "0939034339",
                    "0912679778",
                    "0939878871",
                    "0853116245",
                    "0919884801",
                    "0385444454",
                    "0828383852",
                    "0359022788",
                    "0702882003"
                ]
            ],

            [
                "main_customer_phone" => "0907890907",
                "ref_customer_phone" => [
                    "0988229435"
                ]
            ],

            [
                "main_customer_phone" => "0396773339",
                "ref_customer_phone" => [
                    "0919902126",
                    "0783853129",
                    "0878214024",
                    "0786804839",
                    "0976073603",
                    "0948789539",
                    "0397167891"
                ]
            ],
            [
                "main_customer_phone" => "0907938763",
                "ref_customer_phone" => [
                    "0976818220",
                    "0907584763",
                    "0393624379",
                    "0898496405",
                    "0775890417",
                    "0927110449",
                    "0919752978",
                    "0362347535"
                ]
            ],
            [
                "main_customer_phone" => "0354675237",
                "ref_customer_phone" => [
                    "0963743446",
                    "0931053160",
                    "0762904578"
                ]
            ],
            [
                "main_customer_phone" => "0817108555",
                "ref_customer_phone" => [
                    "0383637784",
                    "0797150595"
                ]
            ],
            [
                "main_customer_phone" => "0969993660",
                "ref_customer_phone" => [
                    "0919333163",
                    "0358161648",
                    "0918511637",
                    "0972304498",
                    "0704900567"
                ]
            ],
            [
                "main_customer_phone" => "0906116772",
                "ref_customer_phone" => [
                    "0773340484"
                ]
            ],
            [
                "main_customer_phone" => "0836169936",
                "ref_customer_phone" => [
                    "0944839283"
                ]
            ],
            [
                "main_customer_phone" => "0919333163",
                "ref_customer_phone" => [
                    "0912439268",
                    "0854990029",
                    "0854999956",
                    "0357928689"
                ]
            ],
            [
                "main_customer_phone" => "0358161648",
                "ref_customer_phone" => [
                    "0787933550",
                    "0906209952"
                ]
            ],
            [
                "main_customer_phone" => "0878353993",
                "ref_customer_phone" => [
                    "0866806042"
                ]
            ],
            [
                "main_customer_phone" => "0902930005",
                "ref_customer_phone" => [
                    "0938529069",
                    "0902921194",
                    "0973991056"
                ]
            ],
            [
                "main_customer_phone" => "0354071104",
                "ref_customer_phone" => [
                    "0923050025"
                ]
            ],
            [
                "main_customer_phone" => "0986587666",
                "ref_customer_phone" => [
                    "0917587666",
                    "0982666157",
                    "0945518518"
                ]
            ],
            [
                "main_customer_phone" => "0358092241",
                "ref_customer_phone" => [
                    "0337111838"
                ]
            ],
            [
                "main_customer_phone" => "0946861119",
                "ref_customer_phone" => [
                    "0934550176"
                ]
            ],
        ];

        foreach ($dataRef as $item) {
            $main_customer_phone = $item['main_customer_phone'];
            $ref_customer_phones = $item['ref_customer_phone'];

            foreach ($ref_customer_phones  as   $ref_customer_phone) {
                if ($ref_customer_phone !=  $main_customer_phone) {

                    $customerMain = Customer::where('phone_number', $main_customer_phone)->where('store_id', 1259)->first();

                    if ($customerMain  != null) {
                        $customerRef = Customer::where('phone_number', $ref_customer_phone)->where('store_id', 1259)->first();

                        if ($customerRef != null) {
                            $customerRef->update([
                                'referral_phone_number' => $main_customer_phone
                            ]);
                         
                        }
                    }
                }
            }
        }



        return response()->json([
            'code' => "",
        ], 200);
    }
}
